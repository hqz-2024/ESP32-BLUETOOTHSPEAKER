# ESP32 蓝牙音箱快速开始指南

## 硬件要求

### 推荐硬件配置
- **ESP32经典版本**（ESP32-WROOM-32、NodeMCU-32S等）
- **8311音频芯片**
- **扬声器**
- **电源模块**
- **音量控制电位器**（可选）

### ⚠️ 重要提醒
**不要使用ESP32-S3！** ESP32-S3不支持经典蓝牙A2DP协议，无法实现蓝牙音箱功能。

## 硬件连接

```
ESP32      8311芯片
IO14   ->  MCK  (Master Clock)
IO15   ->  DOUT (Data Out)
IO16   ->  BCK  (Bit Clock)
IO17   ->  WS   (Word Select)

其他连接：
IO0    ->  BOOT按钮（恢复出厂设置）
IO7    ->  音量控制电位器中心脚
3.3V   ->  电位器一端
GND    ->  电位器另一端
```

## 软件安装

### 1. 安装PlatformIO

```bash
# 安装PlatformIO Core
pip install platformio

# 或者使用VSCode插件
# 在VSCode中搜索并安装"PlatformIO IDE"
```

### 2. 克隆项目

```bash
git clone <项目地址>
cd websit-control-hardware
```

### 3. 编译和上传

```bash
# 进入项目目录
cd arduino_code/ESP-AI-BLUETOOTHSPEAKER

# 编译ESP32经典版本
pio run -e esp32dev

# 上传程序
pio run -e esp32dev -t upload

# 监控串口输出
pio device monitor -e esp32dev
```

## 使用步骤

### 1. 首次启动
1. 上传程序后，ESP32会自动重启
2. 串口输出显示"ESP32 蓝牙A2DP音箱启动中..."
3. 设备进入蓝牙广播模式，名称为"ESP-AI-SPEAKER"

### 2. 手机连接
1. 打开手机蓝牙设置
2. 搜索蓝牙设备
3. 找到"ESP-AI-SPEAKER"并点击连接
4. 连接成功后，串口显示"蓝牙设备已连接"

### 3. 播放音频
1. 在手机上播放任何音频（音乐、视频、通话等）
2. 音频会自动通过ESP32音箱播放
3. 支持播放控制（播放/暂停/上一首/下一首）

### 4. 音量控制
- 通过IO7连接的电位器调节音量
- 顺时针旋转增大音量，逆时针减小音量
- 串口会显示当前音量值

### 5. 恢复出厂设置
- 快速连按IO0按钮5次
- 串口显示"检测到5次点击，执行恢复出厂设置..."
- 设备自动重启并清除蓝牙配对记录

## 串口调试信息

连接串口（115200波特率）可以看到详细的调试信息：

```
ESP32 蓝牙A2DP音箱启动中...
I2S初始化成功
检测到已配对设备，启用自动重连模式
蓝牙音箱已启动，设备名称: ESP-AI-SPEAKER
等待蓝牙设备连接...
按钮功能：连按5下BOOT按钮可恢复出厂设置
音量控制：通过IO7的ADC电压调节音量
音量调整: 0.50 (ADC: 2048)
A2DP connection state: Connected
蓝牙设备已连接
蓝牙配置已保存
A2DP audio state: Started
状态 - 连接: 已连接, 音量: 0.50
```

## 常见问题

### Q: 手机搜索不到"ESP-AI-SPEAKER"
**A:** 
1. 确认使用的是ESP32经典版本（非S3）
2. 检查串口输出是否有错误信息
3. 重启ESP32设备
4. 清除手机蓝牙缓存

### Q: 连接成功但没有声音
**A:**
1. 检查I2S引脚连接是否正确
2. 确认8311芯片供电正常
3. 检查扬声器连接
4. 调整音量电位器

### Q: 音质不好或有杂音
**A:**
1. 检查电源质量，使用稳定的5V电源
2. 确认I2S信号线长度不要太长
3. 添加电源滤波电容
4. 检查接地连接

### Q: 连接后经常断开
**A:**
1. 检查ESP32供电是否稳定
2. 确认手机蓝牙功能正常
3. 减少ESP32与手机之间的距离
4. 重启设备重新配对

## 进阶配置

### 修改设备名称
在代码中修改：
```cpp
String deviceName = "ESP-AI-SPEAKER"; // 改为你想要的名称
```

### 调整音频参数
```cpp
i2s_config_t i2s_config = {
    .sample_rate = 44100,  // 采样率
    .bits_per_sample = I2S_BITS_PER_SAMPLE_16BIT,  // 位深度
    // ...
};
```

### 自定义引脚
```cpp
#define I2S_MCK_PIN     14    // 修改为你的引脚
#define I2S_DOUT_PIN    15
#define I2S_BCK_PIN     16
#define I2S_WS_PIN      17
```

## 技术支持

如果遇到问题：
1. 查看串口调试信息
2. 检查硬件连接
3. 确认使用正确的ESP32芯片型号
4. 参考项目文档和示例代码

## 下一步

- 添加LED状态指示
- 集成OLED显示屏显示播放信息
- 添加红外遥控功能
- 支持多设备连接切换
