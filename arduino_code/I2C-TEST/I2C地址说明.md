# I2C åœ°å€é—®é¢˜è¯¦è§£ï¼šä¸ºä»€ä¹ˆ 0x38 æ˜¯æ­£ç¡®çš„ï¼Ÿ

## é—®é¢˜æè¿°

æ‰«æåˆ°çš„è®¾å¤‡åœ°å€æ˜¯ **0x38**ï¼Œä½†æ ¹æ® PCA9554A è§„æ ¼ä¹¦ï¼Œåœ°å€åº”è¯¥æ˜¯ï¼š
- è¯»åœ°å€ï¼š**0x70**
- å†™åœ°å€ï¼š**0x71**

è¿™çœ‹èµ·æ¥åƒæ˜¯åœ°å€é”™è¯¯ï¼Œä½†å®é™…ä¸Š **0x38 æ˜¯å®Œå…¨æ­£ç¡®çš„**ï¼

---

## æ ¹æœ¬åŸå› ï¼š7ä½åœ°å€ vs 8ä½åœ°å€

### I2C åè®®çš„åœ°å€æ ¼å¼

I2C åè®®åœ¨æ€»çº¿ä¸Šä¼ è¾“çš„æ˜¯ **8 ä½åœ°å€**ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚   7 ä½è®¾å¤‡åœ°å€              â”‚ R/W â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
  Bit 7 6 5 4 3 2 1            Bit 0
```

- **Bit 7-1**ï¼š7 ä½è®¾å¤‡åœ°å€
- **Bit 0**ï¼šè¯»å†™ä½ï¼ˆ0=å†™ï¼Œ1=è¯»ï¼‰

### PCA9554A çš„åœ°å€ç»“æ„

æ ¹æ®è§„æ ¼ä¹¦ï¼ŒPCA9554A çš„ 8 ä½åœ°å€æ ¼å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  å›ºå®šå‰ç¼€       â”‚  åœ°å€å¼•è„š   â”‚ R/W â”‚
â”‚  0 1 1 1 0      â”‚  A2 A1 A0   â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
  Bit 7 6 5 4 3    Bit 2 1 0    Bit 0
```

å½“ A2=A1=A0=0ï¼ˆå…¨éƒ¨æ¥åœ°ï¼‰æ—¶ï¼š

```
å†™åœ°å€ (R/W=0): 0 1 1 1 0 0 0 0 = 0x70
è¯»åœ°å€ (R/W=1): 0 1 1 1 0 0 0 1 = 0x71
```

---

## Arduino Wire åº“çš„çº¦å®š

**å…³é”®ç‚¹**ï¼šArduino çš„ `Wire` åº“ä½¿ç”¨ **7 ä½åœ°å€**ï¼ˆä¸åŒ…å« R/W ä½ï¼‰

### ä¸ºä»€ä¹ˆä½¿ç”¨ 7 ä½åœ°å€ï¼Ÿ

1. **ç®€åŒ–ç¼–ç¨‹**ï¼šç¨‹åºå‘˜ä¸éœ€è¦å…³å¿ƒè¯»å†™ä½
2. **è‡ªåŠ¨å¤„ç†**ï¼šWire åº“ä¼šè‡ªåŠ¨æ·»åŠ  R/W ä½
3. **è¡Œä¸šæ ‡å‡†**ï¼šå¤§å¤šæ•° I2C åº“éƒ½é‡‡ç”¨è¿™ç§æ–¹å¼

### åœ°å€è½¬æ¢

ä» 8 ä½åœ°å€è½¬æ¢åˆ° 7 ä½åœ°å€ï¼š

```
8 ä½åœ°å€: 0 1 1 1 0 0 0 0 (0x70)
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              å³ç§» 1 ä½
                 â†“
7 ä½åœ°å€: 0 0 1 1 1 0 0 0 (0x38) âœ…
```

**è®¡ç®—å…¬å¼**ï¼š
```
7ä½åœ°å€ = 8ä½åœ°å€ >> 1
0x38 = 0x70 >> 1
```

---

## è¯¦ç»†åˆ†æ

### äºŒè¿›åˆ¶å¯¹æ¯”

| æ ¼å¼ | äºŒè¿›åˆ¶ | åå…­è¿›åˆ¶ | è¯´æ˜ |
|------|--------|----------|------|
| 8ä½å†™åœ°å€ | `0111 0000` | 0x70 | è§„æ ¼ä¹¦ä¸­çš„å†™åœ°å€ |
| 8ä½è¯»åœ°å€ | `0111 0001` | 0x71 | è§„æ ¼ä¹¦ä¸­çš„è¯»åœ°å€ |
| **7ä½åœ°å€** | `0011 1000` | **0x38** | **Arduino ä½¿ç”¨çš„åœ°å€** âœ… |

### ä½æ“ä½œéªŒè¯

```cpp
// ä» 7 ä½åœ°å€è®¡ç®— 8 ä½åœ°å€
uint8_t addr_7bit = 0x38;
uint8_t addr_8bit_write = (addr_7bit << 1) | 0;  // 0x70
uint8_t addr_8bit_read  = (addr_7bit << 1) | 1;  // 0x71

// ä» 8 ä½åœ°å€è®¡ç®— 7 ä½åœ°å€
uint8_t addr_8bit = 0x70;
uint8_t addr_7bit = addr_8bit >> 1;  // 0x38
```

---

## PCA9554 vs PCA9554A åœ°å€å¯¹æ¯”

### PCA9554ï¼ˆå›ºå®šå‰ç¼€ 00100ï¼‰

| A2 A1 A0 | 7ä½åœ°å€ | 8ä½å†™åœ°å€ | 8ä½è¯»åœ°å€ |
|----------|---------|-----------|-----------|
| 0 0 0    | 0x20    | 0x40      | 0x41      |
| 0 0 1    | 0x21    | 0x42      | 0x43      |
| 0 1 0    | 0x22    | 0x44      | 0x45      |
| 0 1 1    | 0x23    | 0x46      | 0x47      |
| 1 0 0    | 0x24    | 0x48      | 0x49      |
| 1 0 1    | 0x25    | 0x4A      | 0x4B      |
| 1 1 0    | 0x26    | 0x4C      | 0x4D      |
| 1 1 1    | 0x27    | 0x4E      | 0x4F      |

### PCA9554Aï¼ˆå›ºå®šå‰ç¼€ 01110ï¼‰

| A2 A1 A0 | 7ä½åœ°å€ | 8ä½å†™åœ°å€ | 8ä½è¯»åœ°å€ |
|----------|---------|-----------|-----------|
| 0 0 0    | **0x38** | **0x70** | **0x71** |
| 0 0 1    | 0x39    | 0x72      | 0x73      |
| 0 1 0    | 0x3A    | 0x74      | 0x75      |
| 0 1 1    | 0x3B    | 0x76      | 0x77      |
| 1 0 0    | 0x3C    | 0x78      | 0x79      |
| 1 0 1    | 0x3D    | 0x7A      | 0x7B      |
| 1 1 0    | 0x3E    | 0x7C      | 0x7D      |
| 1 1 1    | 0x3F    | 0x7E      | 0x7F      |

---

## å®é™…åº”ç”¨

### åœ¨ Arduino ä¸­ä½¿ç”¨

```cpp
#include <Wire.h>

// ä½¿ç”¨ 7 ä½åœ°å€
#define PCA9554A_ADDR 0x38  // âœ… æ­£ç¡®

void setup() {
  Wire.begin();
  
  // Wire åº“ä¼šè‡ªåŠ¨å¤„ç† R/W ä½
  Wire.beginTransmission(0x38);  // å®é™…å‘é€ 0x70 (å†™)
  Wire.write(0x03);              // å¯„å­˜å™¨åœ°å€
  Wire.endTransmission();
  
  Wire.requestFrom(0x38, 1);     // å®é™…å‘é€ 0x71 (è¯»)
  uint8_t data = Wire.read();
}
```

### é”™è¯¯ç¤ºä¾‹ï¼ˆä¸è¦è¿™æ ·åšï¼‰

```cpp
// âŒ é”™è¯¯ï¼šä½¿ç”¨ 8 ä½åœ°å€
#define PCA9554A_ADDR 0x70  // è¿™æ˜¯é”™è¯¯çš„ï¼

Wire.beginTransmission(0x70);  // Wire ä¼šå‘é€ 0xE0ï¼Œåœ°å€é”™è¯¯ï¼
```

---

## å…³äº 0x7E å¹²æ‰°åœ°å€

ä½ æåˆ°æ‰«æåˆ° 0x7E æ˜¯å¹²æ‰°åœ°å€ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯ï¼š

1. **æ€»çº¿å™ªå£°**ï¼šI2C æ€»çº¿ä¸Šçš„ç”µæ°”å¹²æ‰°
2. **æ—¶åºé—®é¢˜**ï¼šSCL/SDA æ—¶åºä¸ç¨³å®š
3. **ä¸Šæ‹‰ç”µé˜»**ï¼šä¸Šæ‹‰ç”µé˜»å€¼ä¸åˆé€‚
4. **çº¿è·¯é—®é¢˜**ï¼šè¿æ¥çº¿å¤ªé•¿æˆ–æ¥è§¦ä¸è‰¯

### éªŒè¯æ–¹æ³•

```cpp
// å¤šæ¬¡æ‰«æéªŒè¯
for (int i = 0; i < 5; i++) {
  Wire.beginTransmission(0x7E);
  uint8_t error = Wire.endTransmission();
  Serial.printf("æ‰«æ %d: %s\n", i+1, error == 0 ? "æ‰¾åˆ°" : "æœªæ‰¾åˆ°");
  delay(100);
}
```

å¦‚æœ 0x7E æ—¶æœ‰æ—¶æ— ï¼Œé‚£å°±æ˜¯å¹²æ‰°ã€‚çœŸå®è®¾å¤‡åº”è¯¥æ¯æ¬¡éƒ½èƒ½æ‰«æåˆ°ã€‚

---

## æ€»ç»“

### âœ… æ­£ç¡®ç†è§£

1. **0x38 æ˜¯æ­£ç¡®çš„ 7 ä½åœ°å€**
2. **0x70/0x71 æ˜¯ 8 ä½åœ°å€ï¼ˆåŒ…å« R/W ä½ï¼‰**
3. **Arduino Wire åº“ä½¿ç”¨ 7 ä½åœ°å€**
4. **æ²¡æœ‰æ—¶åºé—®é¢˜ï¼Œè¿™æ˜¯æ­£å¸¸çš„åœ°å€æ ¼å¼å·®å¼‚**

### ğŸ“ è®°ä½è¿™ä¸ªå…¬å¼

```
7ä½åœ°å€ = 8ä½åœ°å€ >> 1
8ä½å†™åœ°å€ = (7ä½åœ°å€ << 1) | 0
8ä½è¯»åœ°å€ = (7ä½åœ°å€ << 1) | 1
```

### ğŸ”§ å®é™…ä½¿ç”¨

åœ¨ Arduino ä»£ç ä¸­ï¼š
- âœ… ä½¿ç”¨ `0x38`ï¼ˆ7ä½åœ°å€ï¼‰
- âŒ ä¸è¦ä½¿ç”¨ `0x70` æˆ– `0x71`ï¼ˆ8ä½åœ°å€ï¼‰

---

## å‚è€ƒèµ„æ–™

1. **I2C è§„èŒƒ**ï¼šNXP I2C-bus specification and user manual
2. **PCA9554A æ•°æ®æ‰‹å†Œ**ï¼šæŸ¥çœ‹ "I2C Address" ç« èŠ‚
3. **Arduino Wire åº“æ–‡æ¡£**ï¼šhttps://www.arduino.cc/en/Reference/Wire

---

## æµ‹è¯•ç¨‹åºè¾“å‡ºç¤ºä¾‹

è¿è¡Œ I2C-TEST ç¨‹åºåï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
âœ… æ‰¾åˆ°è®¾å¤‡: 0x38 - PCA9554A (8ä½ I/O æ‰©å±•å™¨)

æµ‹è¯•è®¾å¤‡ 0x38 (PCA9554A):
  åœ°å€åˆ†æ:
    7ä½åœ°å€: 0x38 (0b0111000)
    8ä½å†™åœ°å€: 0x70 (0b01110000)
    8ä½è¯»åœ°å€: 0x71 (0b01110001)

  [1] è¿æ¥æµ‹è¯•: âœ… é€šè¿‡
  [2] è¯»å–æµ‹è¯•: âœ… é€šè¿‡
  [3] ç¨³å®šæ€§æµ‹è¯•: 10/10 æˆåŠŸ âœ…

  [PCA9554A ä¸“é¡¹æµ‹è¯•]
  [4] è¯»å–é…ç½®å¯„å­˜å™¨: âœ… æˆåŠŸ
  [5] è¯»å–è¾“å…¥å¯„å­˜å™¨: âœ… æˆåŠŸ
  [6] è¯»å–è¾“å‡ºå¯„å­˜å™¨: âœ… æˆåŠŸ

  â„¹ï¸  PCA9554A åœ°å€è¯´æ˜:
      - Arduino Wire åº“ä½¿ç”¨ 7 ä½åœ°å€
      - ä½ çš„è®¾å¤‡ 7 ä½åœ°å€: 0x38
      - å¯¹åº” 8 ä½å†™åœ°å€: 0x70
      - å¯¹åº” 8 ä½è¯»åœ°å€: 0x71
      - è¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸æ˜¯åœ°å€é”™è¯¯ï¼
```

è¿™è¯æ˜ä¸€åˆ‡æ­£å¸¸ï¼ğŸ‰

