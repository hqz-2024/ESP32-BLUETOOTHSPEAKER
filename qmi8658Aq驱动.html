<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QMI8658A 驱动开发核心信息整理（基于748E61E1BAEF8C31413DC641004C80DF.pdf）</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h1 {
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-size: 24px;
        }
        h2 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
            font-size: 20px;
        }
        h3 {
            font-size: 18px;
            color: #34495e;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #2c3e50;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        .note {
            padding: 10px;
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
            color: #1565c0;
        }
        .code {
            font-family: "Courier New", Courier, monospace;
            background-color: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QMI8658A 驱动开发核心信息整理</h1>
        <p>基于规格书 <strong>748E61E1BAEF8C31413DC641004C80DF.pdf</strong> 提取，包含驱动开发必需的硬件接口、寄存器配置、数据读取等核心内容。</p>

        <!-- 一、硬件基础信息 -->
        <h2>一、硬件基础信息</h2>

        <h3>1.1 供电要求</h3>
        <table>
            <tr>
                <th>电源类型</th>
                <th>电压范围（V）</th>
                <th>典型值（V）</th>
                <th>关键要求</th>
            </tr>
            <tr>
                <td>VDD（核心电源）</td>
                <td>1.71 - 3.6</td>
                <td>1.8</td>
                <td>需与VDDIO同步上电；单电源供电时，电压从1.1V（POR阈值）升至1.71V的斜率需＞40V/s，避免初始化失败</td>
            </tr>
            <tr>
                <td>VDDIO（IO电源）</td>
                <td>1.71 - 3.6</td>
                <td>1.8</td>
                <td>独立供电时需先于VDD上电（VDDdelay≥0）；电源线上无尖峰脉冲，防止干扰初始化</td>
            </tr>
        </table>

        <h3>1.2 核心引脚功能（驱动开发相关）</h3>
        <table>
            <tr>
                <th>引脚号</th>
                <th>引脚名</th>
                <th>类型</th>
                <th>核心功能</th>
            </tr>
            <tr>
                <td>1</td>
                <td>SDO/SA0</td>
                <td>O</td>
                <td>SPI-4线模式：SDO（数据输出）；I2C/I3C模式：SA0（地址选择，高=0x6A，低=0x6B）</td>
            </tr>
            <tr>
                <td>5</td>
                <td>VDDIO</td>
                <td>I</td>
                <td>IO引脚电源输入</td>
            </tr>
            <tr>
                <td>6/7</td>
                <td>GND</td>
                <td>I</td>
                <td>接地（0V）</td>
            </tr>
            <tr>
                <td>8</td>
                <td>VDD</td>
                <td>I</td>
                <td>核心电源输入</td>
            </tr>
            <tr>
                <td>9</td>
                <td>INT2</td>
                <td>O</td>
                <td>可编程中断2，默认可配置为DRDY（数据就绪）信号；支持推挽/高阻模式</td>
            </tr>
            <tr>
                <td>12</td>
                <td>CS</td>
                <td>I</td>
                <td>接口选择：高电平=I2C/I3C模式，低电平=SPI模式</td>
            </tr>
            <tr>
                <td>13</td>
                <td>SCL</td>
                <td>IO</td>
                <td>SPI模式：SPC（串行时钟）；I2C/I3C模式：SCL（时钟线）</td>
            </tr>
            <tr>
                <td>14</td>
                <td>SDA</td>
                <td>IO</td>
                <td>SPI-4线：SDI（数据输入）；SPI-3线：SDIO（双向数据）；I2C/I3C：SDA（数据线）</td>
            </tr>
        </table>

        <h3>1.3 通信接口参数</h3>
        <table>
            <tr>
                <th>接口类型</th>
                <th>关键参数</th>
                <th>配置说明</th>
            </tr>
            <tr>
                <td>SPI（3/4线）</td>
                <td>最高频率15MHz；支持Mode 0（CPOL=0,CPHA=0）、Mode 3（CPOL=1,CPHA=1）</td>
                <td>通过<code class="code">CTRL1.bit7</code>配置：0=4线，1=3线；地址自增通过<code class="code">CTRL1.bit6</code>：0=关闭，1=开启</td>
            </tr>
            <tr>
                <td>I2C</td>
                <td>最高频率400kHz（Fast Mode）；从地址0x6A（SA0=1）或0x6B（SA0=0）</td>
                <td>默认内部200KΩ上拉（复位后自动禁用）；需外部配置SA0引脚电平确定地址</td>
            </tr>
            <tr>
                <td>I3C</td>
                <td>标准数据率（SDR）最高12.5MHz；静态地址与I2C一致</td>
                <td>不支持HDR和IBI；PID=0x086E00051000，厂商ID（VID）=0x0437</td>
            </tr>
        </table>

        <!-- 二、核心寄存器配置 -->
        <h2>二、核心寄存器配置</h2>

        <h3>2.1 设备识别与复位寄存器</h3>
        <table>
            <tr>
                <th>地址（Hex）</th>
                <th>寄存器名</th>
                <th>类型</th>
                <th>核心功能</th>
                <th>默认值</th>
            </tr>
            <tr>
                <td>0x00</td>
                <td>WHO_AM_I</td>
                <td>R</td>
                <td>设备ID，驱动初始化时识别芯片（确认是否为QMI8658A）</td>
                <td>0x05</td>
            </tr>
            <tr>
                <td>0x01</td>
                <td>REVISION_ID</td>
                <td>R</td>
                <td>芯片版本ID，确认硬件版本兼容性</td>
                <td>0x7C</td>
            </tr>
            <tr>
                <td>0x60</td>
                <td>RESET</td>
                <td>W</td>
                <td>软复位：写入0xB0触发；复位后需等待15ms完成初始化</td>
                <td>0x00</td>
            </tr>
        </table>

        <h3>2.2 传感器使能与模式配置（CTRL7，地址0x08）</h3>
        <table>
            <tr>
                <th>位段</th>
                <th>功能</th>
                <th>配置选项</th>
                <th>配置示例</th>
            </tr>
            <tr>
                <td>bit7（SyncSample）</td>
                <td>同步锁存模式</td>
                <td>0=非同步模式，1=同步模式（数据锁存，避免读取时更新）</td>
                <td rowspan="3">使能6轴（accel+gyro）+同步模式：0x83<br>仅使能加速度计：0x01</td>
            </tr>
            <tr>
                <td>bit1（gEN）</td>
                <td>陀螺仪使能</td>
                <td>0=禁用，1=使能</td>
            </tr>
            <tr>
                <td>bit0（aEN）</td>
                <td>加速度计使能</td>
                <td>0=禁用，1=使能</td>
            </tr>
        </table>

        <h3>2.3 加速度计配置（CTRL2，地址0x03）</h3>
        <table>
            <tr>
                <th>位段</th>
                <th>功能</th>
                <th>配置选项</th>
            </tr>
            <tr>
                <td>bit7（aST）</td>
                <td>自测试使能</td>
                <td>0=禁用，1=使能（需配合自测试流程）</td>
            </tr>
            <tr>
                <td>bit6-4（aFS）</td>
                <td>量程选择</td>
                <td>000=±2g，001=±4g，010=±8g，011=±16g</td>
            </tr>
            <tr>
                <td>bit3-0（aODR）</td>
                <td>输出数据率（Hz）</td>
                <td>0011=1000（仅accel），0100=500（仅accel），1100=128（低功耗）</td>
            </tr>
        </table>

        <h3>2.4 陀螺仪配置（CTRL3，地址0x04）</h3>
        <table>
            <tr>
                <th>位段</th>
                <th>功能</th>
                <th>配置选项</th>
            </tr>
            <tr>
                <td>bit7（gST）</td>
                <td>自测试使能</td>
                <td>0=禁用，1=使能（需配合自测试流程）</td>
            </tr>
            <tr>
                <td>bit3-0（gODR）</td>
                <td>输出数据率（Hz）</td>
                <td>0000=7174.4，0001=3587.2，0011=896.8，0100=448.4</td>
            </tr>
        </table>

        <h3>2.5 滤波器配置（CTRL5，地址0x06）</h3>
        <table>
            <tr>
                <th>位段</th>
                <th>功能</th>
                <th>配置选项</th>
            </tr>
            <tr>
                <td>bit6-5（gLPF_MODE）</td>
                <td>陀螺仪低通滤波模式</td>
                <td>00=2.66%ODR，01=3.63%ODR，10=5.39%ODR，11=13.37%ODR</td>
            </tr>
            <tr>
                <td>bit4（gLPF_EN）</td>
                <td>陀螺仪滤波使能</td>
                <td>0=禁用，1=使能</td>
            </tr>
            <tr>
                <td>bit2-1（aLPF_MODE）</td>
                <td>加速度计低通滤波模式</td>
                <td>同陀螺仪滤波模式</td>
            </tr>
            <tr>
                <td>bit0（aLPF_EN）</td>
                <td>加速度计滤波使能</td>
                <td>0=禁用，1=使能</td>
            </tr>
        </table>

        <!-- 三、数据读取与处理 -->
        <h2>三、数据读取与处理</h2>

        <h3>3.1 数据就绪与状态查询</h3>
        <table>
            <tr>
                <th>地址（Hex）</th>
                <th>寄存器名</th>
                <th>关键位</th>
                <th>功能</th>
            </tr>
            <tr>
                <td>0x2D（STATUSINT）</td>
                <td>数据锁存与就绪</td>
                <td>bit0（Avail）：数据可用<br>bit1（Locked）：数据已锁存</td>
                <td>同步模式下，读取此寄存器触发数据锁存</td>
            </tr>
            <tr>
                <td>0x2E（STATUS0）</td>
                <td>数据更新状态</td>
                <td>bit1（gDA）：陀螺仪新数据<br>bit0（aDA）：加速度计新数据</td>
                <td>非同步模式下，查询数据是否更新（避免重复读取）</td>
            </tr>
        </table>

        <h3>3.2 传感器数据寄存器（16位补码，低字节在前）</h3>
        <table>
            <tr>
                <th>数据类型</th>
                <th>低字节地址（Hex）</th>
                <th>高字节地址（Hex）</th>
                <th>单位</th>
                <th>转换公式</th>
            </tr>
            <tr>
                <td>X轴加速度</td>
                <td>0x35（AX_L）</td>
                <td>0x36（AX_H）</td>
                <td>g</td>
                <td>数值 / 量程对应LSB数（如±2g时为16384 LSB/g）</td>
            </tr>
            <tr>
                <td>Y轴加速度</td>
                <td>0x37（AY_L）</td>
                <td>0x38（AY_H）</td>
                <td>g</td>
                <td>同X轴</td>
            </tr>
            <tr>
                <td>Z轴加速度</td>
                <td>0x39（AZ_L）</td>
                <td>0x3A（AZ_H）</td>
                <td>g</td>
                <td>同X轴</td>
            </tr>
            <tr>
                <td>X轴陀螺仪</td>
                <td>0x3B（GX_L）</td>
                <td>0x3C（GX_H）</td>
                <td>dps</td>
                <td>数值 / 量程对应LSB数（如±16dps时为2048 LSB/dps）</td>
            </tr>
            <tr>
                <td>Y轴陀螺仪</td>
                <td>0x3D（GY_L）</td>
                <td>0x3E（GY_H）</td>
                <td>dps</td>
                <td>同X轴</td>
            </tr>
            <tr>
                <td>Z轴陀螺仪</td>
                <td>0x3F（GZ_L）</td>
                <td>0x40（GZ_H）</td>
                <td>dps</td>
                <td>同X轴</td>
            </tr>
            <tr>
                <td>温度</td>
                <td>0x33（TEMP_L）</td>
                <td>0x34（TEMP_H）</td>
                <td>°C</td>
                <td>T = TEMP_H + (TEMP_L / 256)</td>
            </tr>
        </table>

        <h3>3.3 FIFO配置与读取（降低系统功耗）</h3>
        <h4>3.3.1 FIFO核心寄存器</h4>
        <table>
            <tr>
                <th>地址（Hex）</th>
                <th>寄存器名</th>
                <th>功能</th>
                <th>配置示例</th>
            </tr>
            <tr>
                <td>0x14（FIFO_CTRL）</td>
                <td>FIFO控制</td>
                <td>bit7：FIFO_RD_MODE（0=写入，1=读取）<br>bit3-2：FIFO_SIZE（00=16样本，11=128样本）<br>bit1-0：FIFO_MODE（01=FIFO，10=流模式）</td>
                <td>64样本+FIFO模式：0x22</td>
            </tr>
            <tr>
                <td>0x13（FIFO_WTM_TH）</td>
                <td>水位阈值</td>
                <td>设置触发FIFO中断的样本数（单位：样本）</td>
                <td>32样本：0x20</td>
            </tr>
            <tr>
                <td>0x17（FIFO_DATA）</td>
                <td>FIFO数据</td>
                <td>读取FIFO数据（需先开启读取模式）</td>
                <td>-</td>
            </tr>
        </table>

        <h4>3.3.2 FIFO读取流程</h4>
        <ol>
            <li>配置FIFO：写入<code class="code">FIFO_CTRL</code>设置模式与大小，写入<code class="code">FIFO_WTM_TH</code>设置阈值；</li>
            <li>等待中断：FIFO数据达到阈值时，<code class="code">FIFO_STATUS.bit6（FIFO_WTM）</code>置1，触发INT1/INT2；</li>
            <li>开启读取：通过CTRL9发送<code class="code">CTRL_CMD_REQ_FIFO（0x05）</code>，使能FIFO读取模式；</li>
            <li>读取数据：连续读取<code class="code">FIFO_DATA</code>，直至<code class="code">FIFO_STATUS.bit4（FIFO_NOT_EMPTY）</code>为0；</li>
            <li>关闭读取：写入<code class="code">FIFO_CTRL.bit7=0</code>，恢复FIFO写入模式。</li>
        </ol>

        <!-- 四、CTRL9命令协议 -->
        <h2>四、CTRL9命令协议（配置高级功能）</h2>

        <h3>4.1 协议基本流程</h3>
        <ol>
            <li>主机向<code class="code">CTRL9（0x0A）</code>写入目标命令；</li>
            <li>芯片执行命令后，<code class="code">STATUSINT.bit7（CmdDone）</code>置1，触发INT1（若配置）；</li>
            <li>主机向<code class="code">CTRL9</code>写入<code class="code">CTRL_CMD_ACK（0x00）</code>确认；</li>
            <li>芯片清除<code class="code">CmdDone</code>，协议结束。</li>
        </ol>

        <h3>4.2 驱动常用命令</h3>
        <table>
            <tr>
                <th>命令值（Hex）</th>
                <th>命令名</th>
                <th>功能</th>
                <th>应用场景</th>
            </tr>
            <tr>
                <td>0x04</td>
                <td>CTRL_CMD_RST_FIFO</td>
                <td>重置FIFO（清空数据、样本计数与状态标志）</td>
                <td>FIFO读取前初始化</td>
            </tr>
            <tr>
                <td>0x05</td>
                <td>CTRL_CMD_REQ_FIFO</td>
                <td>开启FIFO读取模式（数据定向到FIFO_DATA）</td>
                <td>FIFO数据读取</td>
            </tr>
            <tr>
                <td>0x08</td>
                <td>CTRL_CMD_WRITE_WOM_SETTING</td>
                <td>配置唤醒功能（WoM）的阈值与中断参数</td>
                <td>低功耗运动唤醒场景</td>
            </tr>
            <tr>
                <td>0xA2</td>
                <td>CTRL_CMD_ON_DEMAND_CALIBRATION</td>
                <td>陀螺仪X/Y轴校准（提升精度）</td>
                <td>驱动初始化或精度要求高的场景</td>
            </tr>
            <tr>
                <td>0x0F</td>
                <td>CTRL_CMD_RESET_PEDOMETER</td>
                <td>重置计步器步数（清零STEP_CNT寄存器）</td>
                <td>计步功能初始化</td>
            </tr>
        </table>

        <!-- 五、低功耗模式（Wake on Motion） -->
        <h2>五、低功耗模式配置（Wake on Motion）</h2>

        <h3>5.1 核心配置参数（通过CAL寄存器）</h3>
        <table>
            <tr>
                <th>寄存器</th>
                <th>配置内容</th>
                <th>说明</th>
            </tr>
            <tr>
                <td>CAL1_L（0x0B）</td>
                <td>WoM阈值</td>
                <td>0x00=禁用WoM；非0值为阈值（单位：mg），需根据场景调整</td>
            </tr>
            <tr>
                <td>CAL1_H（0x0C）</td>
                <td>中断配置</td>
                <td>bit7-6：中断引脚（00=INT1，01=INT2）<br>bit5-0：中断空白时间（单位：样本数，过滤启动干扰）</td>
            </tr>
        </table>

        <h3>5.2 配置流程</h3>
        <ol>
            <li>禁用传感器：写入<code class="code">CTRL7 = 0x00</code>；</li>
            <li>配置加速度计：写入<code class="code">CTRL2</code>，设置低功耗ODR（如128Hz）与量程；</li>
            <li>写入WoM参数：<code class="code">CAL1_L</code>设阈值，<code class="code">CAL1_H</code>设中断引脚与空白时间；</li>
            <li>发送命令：通过CTRL9发送<code class="code">CTRL_CMD_WRITE_WOM_SETTING（0x08）</code>；</li>
            <li>使能加速度计：写入<code class="code">CTRL7.aEN = 1</code>（仅加速度计工作，运动时触发INT中断）。</li>
        </ol>

        <!-- 六、自测试流程（驱动初始化校验） -->
        <h2>六、自测试流程（驱动初始化校验）</h2>

        <h3>6.1 加速度计自测试</h3>
        <ol>
            <li>禁用传感器：<code class="code">CTRL7 = 0x00</code>；</li>
            <li>配置ODR：<code class="code">CTRL2.aODR</code>设为1000Hz（或其他合适值）；</li>
            <li>使能自测试：<code class="code">CTRL2.aST = 1</code>；</li>
            <li>等待就绪：查询<code class="code">STATUSINT.bit0 = 1</code>或INT2触发；</li>
            <li>读取结果：从<code class="code">dVX_L（0x51）</code>、<code class="code">dVY_L（0x53）</code>、<code class="code">dVZ_L（0x55）</code>读取数据，绝对值＞200mg则正常；</li>
            <li>禁用自测试：<code class="code">CTRL2.aST = 0</code>。</li>
        </ol>

        <h3>6.2 陀螺仪自测试</h3>
        <ol>
            <li>禁用传感器：<code class="code">CTRL7 = 0x00</code>；</li>
            <li>使能自测试：<code class="code">CTRL3.gST = 1</code>；</li>
            <li>等待就绪：查询<code class="code">STATUSINT.bit0 = 1</code>或INT2触发；</li>
            <li>读取结果：从<code class="code">dVX_L（0x51）</code>、<code class="code">dVY_L（0x53）</code>、<code class="code">dVZ_L（0x55）</code>读取数据，绝对值＞300dps则正常；</li>
            <li>禁用自测试：<code class="code">CTRL3.gST = 0</code>。</li>
        </ol>

        <div class="note">
            <strong>注意</strong>：自测试需在传感器禁用状态下启动，测试完成后需恢复原配置；自测试典型耗时：加速度计约25ms（1KHz ODR），陀螺仪约400ms。
        </div>

        <footer style="margin-top: 50px; text-align: center; color: #7f8c8d;">
            <p>基于规格书 748E61E1BAEF8C31413DC641004C80DF.pdf 整理 | 驱动开发专用</p>
        </footer>
    </div>
</body>
</html>